# Dockerfile for the development environment.
# This sets up a container with both Python and Node.js to run the
# backend and frontend development servers concurrently.

FROM python:3.12-slim

# Install build dependencies for Python packages like Pillow, plus Node.js.
# 'build-essential' provides the GCC compiler needed to compile Pillow.
RUN apt-get update && apt-get install -y --no-install-recommends \
    nodejs \
    npm \
    build-essential \
    zlib1g-dev \
    libjpeg-dev \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copy all dependency definition files.
COPY backend/api/requirements.txt ./api/
COPY backend/ingestion/requirements.txt ./ingestion/
COPY frontend/package*.json ./frontend/

# Install all Python and Node.js dependencies.
RUN pip install --no-cache-dir -r api/requirements.txt && \
    pip install --no-cache-dir -r ingestion/requirements.txt
RUN npm install --prefix frontend

# Copy the development start script into the container.
COPY start-dev.sh .

# Make the script executable.
RUN chmod +x ./start-dev.sh

# The command that will be run when the container starts.
CMD ["./start-dev.sh"]

